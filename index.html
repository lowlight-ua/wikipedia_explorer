<!DOCTYPE html>
<html>
<head>
<style>
</style>
<script src="https://ajax.googleapis.com/ajax/libs/jquery/3.5.1/jquery.min.js"></script>

<script>

class JSONSet extends Set {
    toJSON () {
        return [...this]
    }
}

class Graph
{
    constructor()
    {
        this.links = {};
    }

    addLink(from, to)
    {
        if (!(from in this.links))
        {
            this.links[from] = new JSONSet();
        }
        this.links[from].add(to);
    }
}

class Result
{
    constructor()
    {
        this.graph = new Graph();
        this.operations = 0;
    }

    onStepComplete()
    {
        this.operations++;
        if (this.operations == 2)
        {
            this.onOperationComplete();
        }
    }

    onOperationComplete()
    {
        $("#json_out").append(JSON.stringify(this.graph, null, 2));
    }
}

function onGetResultLinks(data, from)
{
    const dqp = data.query.pages;
    const links = dqp[Object.keys(dqp)[0]].links;
    const titles = links.map(x => x.title);

    let graph = result.graph;
    titles.forEach(i => graph.addLink(from, i));

    result.onStepComplete();
}

function onGetResultBacklinks(data, to)
{
    const dqp = data.query.pages;
    const linkshere = dqp[Object.keys(dqp)[0]].linkshere;
    const titles = linkshere.map(x => x.title);

    let graph = result.graph;
    titles.forEach(i => graph.addLink(i, to));

    result.onStepComplete();
}

function onGoClick()
{
    result = new Result(); 
    let graph = result.graph;

    let thePage = $("#pagetitle").val();
    if (thePage.length == 0)
    {
        return;
    }

    $.ajax( {
        url: 'https://en.wikipedia.org/w/api.php',
        data: {
            action: 'query',
            prop: 'links',
            format: 'json',
            titles: thePage,
            plnamespace: 0,
            origin: '*',
            pllimit: 'max'
        },
        xhrFields: {
            withCredentials: false
        },
        dataType: 'json'
    } ).done(function(data) { onGetResultLinks(data, thePage); });

    $.ajax( {
        url: 'https://en.wikipedia.org/w/api.php',
        data: {
            action: 'query',
            prop: 'linkshere',
            titles: $("#pagetitle").val(),
            format: 'json',
            lhnamespace: 0,
            origin: '*',
            lhlimit: 'max'
        },
        xhrFields: {
            withCredentials: false
        },
        dataType: 'json'
    } ).done(function(data) { onGetResultBacklinks(data, thePage); });  
}

$(document).ready(function()
{    
    $("#gobutton").click(onGoClick);
});

</script>

</head>

<body>

<input type="text" id="pagetitle"><br>
<input type="button" id="gobutton" value="GO">

<div id="output">
    <pre id="json_out">
        NOTHING HERE
    </pre>
</div>

</body>

</html>
